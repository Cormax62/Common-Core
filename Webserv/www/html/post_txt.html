<!doctype html>
<html lang="en">
<head>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Welcome</title>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url("/photos/home.webp");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            color: #222;
        }
        .card {
            text-align: center;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.25);
            background: #f5f3f3;
            max-width: 640px;
            margin: 1rem;
        }
        /* single card that contains all posts; centered content */
        .post-card {
            background: #e08442;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(255, 255, 255, 0.08);
            padding: 1rem;
            margin: 0.75rem auto;
            text-align: center; /* center all text inside the card */
            max-width: 640px;
            font-family: inherit; /* ensure same font as the page */
        }
    .post-card h4 { margin: 0 0 0.25rem; font-size: 1rem; font-family: inherit; }
    .post-card p { margin: 0.35rem 0; color: #ffffff; font-size: 0.95rem; font-family: inherit; }
    .post-item { display: block; text-align: center; font-family: inherit; }
        h1 { margin: 0 0 0.5rem; font-size: 1.6rem; }
        p { margin: 0.25rem 0; color: #555; }
        footer { margin-top: 1rem; font-size: 0.85rem; color: #888; }
    </style>
</head>
<body>
    <main class="card" role="main">
        <h1>Here you can test the POST with text!</h1>
        <p>It works by using CGIs made in .php</p>
        <p>
            <a href="/" style="display:inline-block;margin-top:1rem;padding:0.6rem 1rem;border-radius:6px;background:#ce7231;color:#fff;text-decoration:none;font-weight:600;">Return home</a>
        </p>
        <p>
            <form id="postForm" style="display:inline-block;margin-top:1rem;">
                <input id="caption" name="caption" type="text" placeholder="Write a caption..." 
                    style="font-family: inherit;padding:0.6rem 1rem;border-radius:6px;border:1px solid #ccc;margin-right:0.6rem;">
                <button type="submit" 
                    style="font-family: inherit;padding:0.6rem 1rem;border-radius:6px;background:#ce7231;color:#fff;border:none;font-weight:600;">
                    Send
                </button>
                <button id="deleteBtn" type="button"
                    style="font-family: inherit;padding:0.6rem 1rem;border-radius:6px;background:#9b2f2f;color:#fff;border:none;font-weight:600;margin-left:0.5rem;">
                    Delete
                </button>
            </form>
            <div id="result" style="margin-top:0.6rem;color:#333;font-weight:600;"></div>
            <div id="post" style="margin-top:1rem;color:#222;"></div>
        </p>
        <script>
        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const caption = document.getElementById('caption').value;
            // Send to server (expects a POST handler at /post)
            fetch('/post/text_POST.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                /* send the caption as a raw JSON string instead of an object */
                body: JSON.stringify(caption)
            })
            .then(res => res.text())
            .then(text => {
                document.getElementById('result').textContent = 'Server: ' + text;
                // refresh list after successful POST
                fetchpost();
            })
            .catch(err => { document.getElementById('result').textContent = 'Error: ' + err.message; });
        });
        
        // Fetch and display stored captions
        function fetchpost() {
            fetch('/post/text_GET.php')
            .then(res => {
                if (!res.ok) throw new Error('Network response not ok');
                return res.json();
            })
            .then(arr => {
                const container = document.getElementById('post');
                container.innerHTML = '';
                if (!Array.isArray(arr) || arr.length === 0) {
                    container.textContent = 'No captions yet.';
                    return;
                }

                // Create a single card container for all fetched items
                const card = document.createElement('div');
                card.className = 'post-card';

                // If the array is empty we've already handled above, so iterate and append items
                arr.forEach(rawItem => {
                    // remove leading markers like "///////:" if present
                    const cleaned = String(rawItem).replace(/^[\/:]+/, '').trim();

                    if (cleaned.indexOf('|') !== -1) {
                        const parts = cleaned.split('|').map(s => s.trim()).filter(Boolean);
                        // title (first part) as a heading inside the shared card
                        const title = document.createElement('h4');
                        title.textContent = parts[0] || '';
                        card.appendChild(title);

                        // append remaining params as centered paragraphs
                        for (let i = 1; i < parts.length; ++i) {
                            const p = document.createElement('p');
                            p.className = 'post-item';
                            p.textContent = parts[i];
                            card.appendChild(p);
                        }
                    } else {
                        // simple caption as a centered paragraph
                        const p = document.createElement('p');
                        p.className = 'post-item';
                        p.textContent = cleaned;
                        card.appendChild(p);
                    }
                });

                container.appendChild(card);
            })
            .catch(err => { document.getElementById('post').textContent = 'Error fetching post: ' + err.message; });
        }

        // Delete button: send DELETE /post with the caption in the body, then refresh
        document.getElementById('deleteBtn').addEventListener('click', function() {
            const caption = document.getElementById('caption').value;
            fetch('/post/text_DELETE.php', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(caption)
            })
            .then(res => res.text())
            .then(text => {
                document.getElementById('result').textContent = 'Server: ' + text;
                fetchpost();
            })
            .catch(err => { document.getElementById('result').textContent = 'Error: ' + err.message; });
        });
        window.addEventListener('DOMContentLoaded', fetchpost);
        </script>
    </main>
</body>
</html>