<!doctype html>
<html lang="en">
<head>
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Login</title>
	<style>
		body {
			font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
			margin: 0;
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			background-image: url("/photos/home.webp");
			background-size: cover;
			background-repeat: no-repeat;
			background-position: center center;
			color: #222;
		}
		.card {
			text-align: center;
			padding: 2rem;
			border-radius: 8px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.25);
			background: #f5f3f3;
			max-width: 480px;
			margin: 1rem;
		}
		h1 { margin: 0 0 0.5rem; font-size: 1.6rem; }
		p { margin: 0.25rem 0; color: #555; }
		form { margin-top: 1rem; display: grid; gap: 0.75rem; }
		label { text-align: left; font-weight: 600; color: #444; }
		input[type="text"], input[type="password"] {
			width: 100%;
			padding: 0.55rem 0.65rem;
			border-radius: 6px;
			border: 1px solid #ccc;
			font-size: 1rem;
			font-family: inherit;
			box-sizing: border-box;
		}
		button {
			font-family: inherit;
			display: inline-block;
			margin-top: 0.5rem;
			padding: 0.65rem 1rem;
			border-radius: 6px;
			background: #6e370f;
			color: #fff;
			text-decoration: none;
			font-weight: 600;
			border: none;
			cursor: pointer;
			font-size: 1rem;
		}
		button:hover { background: #8a4612; }
		.link-row { margin-top: 1rem; }
		.link-row a {
			display: inline-block;
			margin-top: 0.5rem;
			padding: 0.6rem 1rem;
			border-radius: 6px;
			background: #ce7231;
			color: #fff;
			text-decoration: none;
			font-weight: 600;
		}
		.link-row a:hover { background: #e08041; }
		#status { margin-top: 0.5rem; font-size: 0.95rem; color: #555; min-height: 1.2rem; }
	</style>
</head>
<body>
	<main class="card" role="main">
		<h1>Login</h1>
		<p>Create your account and access the site.</p>

		<form id="login-form" method="POST" action="/login">
			<div>
				<label for="nickname">Nickname</label>
				<input id="nickname" name="nickname" type="text" required autocomplete="username">
			</div>
			<div>
				<label for="password">Password</label>
				<input id="password" name="password" type="password" required autocomplete="current-password">
			</div>
			<button type="submit">Create account / Login</button>
			<div id="status"></div>
			<p>
            	<a href="/" style="display:inline-block;margin-top:1rem;padding:0.6rem 1rem;border-radius:6px;background:#ce7231;color:#fff;text-decoration:none;font-weight:600;">Return home</a>
        	</p>
		</form>
	</main>

	<script>
		const form = document.getElementById('login-form');
		const statusBox = document.getElementById('status');

		form.addEventListener('submit', function (e) {
			e.preventDefault();
			statusBox.textContent = 'Sending...';

			const data = new URLSearchParams(new FormData(form));

			fetch('/login/login.php', {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: data.toString()
			})
			.then(res => res.text().then(text => ({ ok: res.ok, text: text.trim() })))
			.then(({ ok, text }) => {
				if (text === 'LOGIN') {
					statusBox.textContent = 'Success! Creating session...';
					fetch('/login', { method: 'GET', credentials: 'include' })
						.then(() => {
							statusBox.textContent = 'Session created! Redirecting...';
							window.location.href = '/';
						})
						.catch(err => {
							statusBox.textContent = 'Error creating session: ' + err.message;
						});
					return;
				}
				if (text === 'WRONG PARAMETER') {
					statusBox.textContent = 'Wrong parameter';
					return;
				}
				if (text === 'ACCOUNT SAVED') {
					statusBox.textContent = 'Account saved!';
					return;
				}
				if (!ok) {
					statusBox.textContent = text ? ('Error: ' + text) : 'Login failed';
					return;
				}
				statusBox.textContent = text || 'Unexpected response';
			})
			.catch(err => {
				statusBox.textContent = 'Error: ' + err.message;
			});
		});
	</script>
</body>
</html>
